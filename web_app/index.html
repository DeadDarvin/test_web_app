<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram WebApps API</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Общий стиль страницы HTML */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: var(--tg-theme-bg-color);
        }

        @font-face {
            font-family: 'SF Pro'; /* Название шрифта */
            src: url('fonts/SFProText-Semibold.ttf') format('truetype'); /* Укажите правильный путь к вашему файлу шрифта и формат */
            /* Добавьте другие форматы, если у вас есть файлы других форматов (например, .woff2) */
        }

        /* Стиль контейнера */
        .container {
            display: flex;
            flex-direction: row; /* Изменяем направление на горизонтальное */
            justify-content: center;
            min-height: 100vh;
            flex-wrap: wrap; /* Разрешаем перенос элементов на новую строку */
        }

        /* Стиль иконки персонажа */
        .character-icon {
            width: 150px;
            height: 123px;
            margin-top: 25px;
            margin-left: 8px;
            margin-right: 8px;
            padding-top: 14%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            box-shadow: 0px 15px 15px #00000018;
            border: 2px solid #27A7E7;
            border-radius: 18px;
            opacity: 1;
            backdrop-filter: blur(50px);
            -webkit-backdrop-filter: blur(50px);
            cursor: pointer; /* Добавляем указатель при наведении для обозначения кликабельности */
        }

        /* Стиль текста персонажа */
        .character-text {
            text-align: center;
            font-family: 'SF Pro', sans-serif; /* Используем шрифт 'SF Pro', и если его нет, используем sans-serif */
            font-weight: bold;
            font-size: 20px; /* Можно задать размер шрифта напрямую, так как мы подключили шрифт 'SF Pro' */
            line-height: 20px; /* Задаем высоту строки, если нужно */
            letter-spacing: 0px;
            color: #27A7E7;
            text-shadow: 0px 5px 5px #00000008;
            opacity: 1;
            height: auto; /* Высота автоматически подстраивается под содержимое */
            background: transparent; /* Убираем фон */
            border: none; /* Убираем рамку */
            padding: 0; /* Убираем отступы внутри элемента */
            margin-top: 10px;
            margin-bottom: 25px;
            max-width: 150px;
            margin-left: 8px;
            margin-right: 8px;
        }

        /* fill blue when user click on person-icon */
        .pair-container:active {
            background-color: #7CB9E8;
        }


    </style>
</head>
<body>
    <div class="container">
         <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/cyberpunk-2077.gif');" onclick="handleCharacterClick('cyberpunk');"></div>
            <div class="character-text">Киберпанк 2077</div>
        </div>
        <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/the-lord-of-the-rings.gif');" onclick="handleCharacterClick('lord-rings');"></div>
            <div class="character-text">Властелин колец</div>
        </div>
        <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/avatar.gif');" onclick="handleCharacterClick('avatar');"></div>
            <div class="character-text">Аватар</div>
        </div>
        <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/pharaoh.gif');" onclick="handleCharacterClick('pharaoh');"></div>
            <div class="character-text">Египетский Фараон</div>
        </div>
        <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/marvel-comics.gif');" onclick="handleCharacterClick('marvel');"></div>
            <div class="character-text">Марвел Комиксы</div>
        </div>
        <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/inventor.gif');" onclick="handleCharacterClick('inventor');"></div>
            <div class="character-text">Изобретатель</div>
        </div>
        <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/astronaut.gif');" onclick="handleCharacterClick('astronaut');"></div>
            <div class="character-text">Астронавт</div>
        </div>
        <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/mythologist.gif');" onclick="handleCharacterClick('mythologist');"></div>
            <div class="character-text">Мифолог</div>
        </div>
        <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/investigator.gif');" onclick="handleCharacterClick('investigator');"></div>
            <div class="character-text">Исследователь</div>
        </div>
        <div class="pair-container">
            <div class="character-icon" style="background-image: url('img/gothic.gif');" onclick="handleCharacterClick('gothic');"></div>
            <div class="character-text">Готика</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/pirate.gif');" onclick="handleCharacterClick('pirate');"></div>
             <div class="character-text">Пират</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/thug.gif');" onclick="handleCharacterClick('thug');"></div>
             <div class="character-text">Головорез</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/artist.gif');" onclick="handleCharacterClick('artist');"></div>
             <div class="character-text">Художник</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/viking.gif');" onclick="handleCharacterClick('viking');"></div>
             <div class="character-text">Викинг</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/detective.gif');" onclick="handleCharacterClick('detective');"></div>
             <div class="character-text">Детектив</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/art-deco.gif');" onclick="handleCharacterClick('art-deco');"></div>
             <div class="character-text">Арт-Деко</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/fantasy-warrior.gif');" onclick="handleCharacterClick('fantasy-warrior');"></div>
             <div class="character-text">Фэнтези Воин</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/aristocrat.gif');" onclick="handleCharacterClick('aristocrat');"></div>
             <div class="character-text">Аристократ</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/gladiator.gif');" onclick="handleCharacterClick('gladiator');"></div>
             <div class="character-text">Гладиатор</div>
        </div>
        <div class="pair-container">
             <div class="character-icon" style="background-image: url('img/rebel.gif');" onclick="handleCharacterClick('rebel');"></div>
             <div class="character-text">Повстанец</div>
        </div>
    </div>
</body>
<script>
    let userId;
    let tg = window.Telegram.WebApp;
    const url = "https://694a-91-105-180-185.ngrok-free.app";

    const headers = {
        'Content-Type': 'application/json',
        'Authorization': tg.initDataUnsafe.hash,
        'Init-Data': tg.initData
    };

    tg.expand();
    userId = tg.initDataUnsafe.user.id;

    function UserHasOpenedWebApp(url) {

        let endpoint = url + '/analyze'
        let data = {
            user_id: userId
        }

        fetch(endpoint, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success:', data);
            console.log("Data has been sent!");
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }

    UserHasOpenedWebApp(url);

    function handleCharacterClick(character) {
        let data = {
            user_id: userId,
            person_name: character
        }

        fetch(url, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success:', data);
            console.log("Data has been sent!");
            tg.close();
        })
        .catch((error) => {
            console.error('Error:', error);
            tg.close()
        });
    }
</script>
</html>
