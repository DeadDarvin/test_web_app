let userId;
let tg = window.Telegram.WebApp;
const url = "https://c985-91-105-181-137.ngrok-free.app";

const headers = {
    'Content-Type': 'application/json',
    'Authorization': tg.initDataUnsafe.hash,
    'Init-Data': tg.initData
};

tg.expand();
userId = tg.initDataUnsafe.user.id;

function UserHasOpenedWebApp(url) {
    let urlWithUserID = url + '?user_id=' + encodeURIComponent(userId);

    fetch(urlWithUserID, {
        method: 'GET',
        headers: headers,
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        console.log("Data has been sent!");
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}

UserHasOpenedWebApp(url);

function handleCharacterClick(character) {
    let data = {
        user_id: userId,
        person_name: character
    }

    fetch(url, {
        method: 'POST',
        headers: headers,
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        console.log("Data has been sent!");
        tg.close();
    })
    .catch((error) => {
        console.error('Error:', error);
        tg.close()
    });
}
